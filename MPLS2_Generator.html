<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Script MPLS2 para Huawei</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos generales para el cuerpo del documento - Adaptado a estilo desarrollador */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: #1a1a2e; /* Fondo oscuro principal */
            color: #e0e0e0; /* Texto claro */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Alinea al inicio para permitir scroll si es necesario */
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            background-image: linear-gradient(to bottom right, #1a1a2e, #0f0f1d); /* Degradado sutil */
        }
        /* Estilos para el contenedor principal del formulario */
        .container {
            background-color: #2a2a4a; /* Contenedor más oscuro */
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            max-width: 950px;
            width: 100%;
            margin: 20px auto; /* Margen superior e inferior para separación */
            border: 1px solid #4a4a70;
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Estilos para los títulos principales y subtítulos */
        h2 {
            font-family: 'Roboto Mono', monospace; /* Fuente monoespaciada */
            color: #00ffcc; /* Verde neón vibrante */
            border-bottom: 2px solid #4a4a70; /* Borde más sutil */
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 2.5em; /* Título grande */
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.6);
            text-align: center; /* Centrar el título */
        }

        h3 {
            color: #ffffff; /* Blanco para subtítulos de sección */
            border-bottom: 1px solid #4a4a70;
            padding-bottom: 8px;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 600;
            text-align: left;
        }

        p {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            margin-bottom: 25px;
            font-size: 1em;
            color: #b0b0d0; /* Gris azulado */
            text-align: left;
        }

        /* Estilos para cada grupo de formulario (label + input/textarea) */
        .form-group {
            margin-bottom: 20px;
        }
        /* Estilos para las etiquetas de los campos del formulario */
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #00ffcc; /* Verde neón para etiquetas */
            font-family: 'Roboto Mono', monospace;
            font-size: 0.95em;
        }
        /* Estilos para los campos de entrada de texto y número, y el área de texto */
        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group textarea {
            width: calc(100% - 24px); /* Ajuste para padding y borde */
            padding: 12px;
            border: 1px solid #4a4a70; /* Borde oscuro */
            border-radius: 6px;
            font-size: 1em;
            background-color: #1a1a2e; /* Fondo oscuro para inputs */
            color: #e0e0e0; /* Texto claro en inputs */
            font-family: 'Roboto Mono', monospace; /* Monospace para inputs */
        }
        /* Estilos para los campos cuando están en foco */
        .form-group input:focus,
        .form-group textarea:focus {
            border-color: #007bff; /* Azul vibrante al enfocar */
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.4);
        }
        /* Estilos para las descripciones de los campos */
        .form-group .description {
            font-size: 0.8em;
            color: #8888a0; /* Gris más suave para descripciones */
            margin-top: 5px;
            font-family: 'Inter', sans-serif;
        }

        /* Estilos unificados para botones */
        .main-button {
            background-color: #28a745; /* Verde para acción principal */
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 20px;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
            font-family: 'Inter', sans-serif;
            font-weight: bold;
        }
        .main-button:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(40, 167, 69, 0.5);
        }

        .download-button {
            background-color: #007bff; /* Azul vibrante para descargar */
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 20px;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
            font-family: 'Inter', sans-serif;
            font-weight: bold;
        }
        .download-button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.5);
        }

        .back-button {
            background-color: #6c757d; /* Gris para volver */
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }
        .back-button:hover {
            background-color: #5a6268;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Estilo para el texto rojo */
        .red-text {
            color: #ff6347; /* Un rojo más suave, tipo "tomato" */
        }

        /* Estilos para el área de texto donde se muestra el script generado */
        #scriptGenerado {
            background-color: #1a1a2e; /* Fondo muy oscuro para el código */
            border: 1px dashed #00ffcc; /* Borde punteado neón */
            padding: 15px;
            min-height: 400px; /* Un poco más grande */
            font-family: 'Roboto Mono', monospace; /* Monospace para el código */
            color: #00ffcc; /* Código en verde neón */
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 30px;
            resize: vertical;
            border-radius: 6px;
            box-shadow: inset 0 0 10px rgba(0, 255, 204, 0.2); /* Sombra interna para el brillo */
            width: calc(100% - 30px); /* Ajuste para padding y margen */
        }

        /* Responsive adjustments for buttons to stack on mobile */
        @media (min-width: 768px) {
            .form-actions {
                display: flex;
                gap: 15px; /* Espacio entre botones en desktop */
            }
            .main-button, .download-button, .back-button {
                width: auto; /* Vuelve a ancho automático en desktop */
                margin-left: 0; /* No hay margen izquierdo para el primero */
                margin-top: 20px; /* Consistente con otros botones */
            }
            .download-button, .back-button {
                margin-left: 10px; /* Espacio entre botones en desktop */
            }
        }
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px auto;
            }
            h2 {
                font-size: 1.8em;
                margin-bottom: 20px;
            }
            h3 {
                font-size: 1.3em;
            }
            .form-group label, .form-group .description {
                font-size: 0.85em;
            }
            .form-group input, .form-group textarea {
                font-size: 0.9em;
                padding: 10px;
            }
            #scriptGenerado {
                min-height: 250px;
            }

            /* Responsive button stacking */
            .main-button, .download-button, .back-button {
                margin-left: 0; /* Elimina margen en móviles */
                display: block; /* Ocupa todo el ancho */
                width: 100%; /* Toma el 100% del ancho del contenedor */
                margin-top: 10px; /* Espacio vertical entre botones apilados */
            }
            .form-actions {
                flex-direction: column; /* Apila los botones verticalmente */
                gap: 0; /* Elimina el espacio horizontal entre botones */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Generador de Script <span class="red-text">MPLS2</span> para Huawei</h2>
        <p>Por favor, complete los siguientes campos para generar el script de configuración de su dispositivo Huawei.</p>

        <form id="mplsConfigForm">
            <h3>Información General del Router</h3>
            <div class="form-group">
                <label for="IS-NAME">Nombre del Router (Hostname):</label>
                <input type="text" id="IS-NAME" name="IS-NAME" placeholder="Ej: AR-OLT-SedeCentral" required>
                <div class="description">El nombre de identificación del dispositivo, que también se usará para el IS-Name de ISIS.</div>
            </div>

            <div class="form-group">
                <label for="LOOPBACK0">Dirección IP de Loopback (IPv4):</label>
                <input type="text" id="LOOPBACK0" name="LOOPBACK0" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}(\/32)?$" placeholder="Ej: 10.255.255.1/32" required>
                <div class="description">La dirección IP principal para el Router ID y estabilidad del enrutamiento.</div>
            </div>

            <h3>Configuración ISIS</h3>
            <div class="form-group">
                <label for="ISIS_PROCESS_1">ID de Proceso ISIS 1:</label>
                <input type="number" id="ISIS_PROCESS_1" name="ISIS_PROCESS_1" placeholder="Ej: 100" required>
                <div class="description">El ID para la primera instancia de proceso ISIS.</div>
            </div>

            <div class="form-group">
                <label for="ISIS_PROCESS_2">ID de Proceso ISIS 2 (Opcional):</label>
                <input type="number" id="ISIS_PROCESS_2" name="ISIS_PROCESS_2" placeholder="Ej: 200 (dejar en blanco si no aplica)">
                <div class="description">Si se necesita una segunda instancia de proceso ISIS.</div>
            </div>

            <div class="form-group">
                <label for="NETWORK-ENTITY-1">Entidad de Red ISIS 1 (NET 1):</label>
                <input type="text" id="NETWORK-ENTITY-1" name="NETWORK-ENTITY-1" pattern="^([0-9A-Fa-f]{2}\.){3}([0-9A-Fa-f]{4}\.){2}[0-9A-Fa-f]{2}$" placeholder="Ej: 49.0001.0000.0001.00" required>
                <div class="description">La dirección NET para la primera instancia ISIS (formato 49.xxxx.yyyy.zzzz.00).</div>
            </div>

            <div class="form-group">
                <label for="NETWORK-ENTITY-2">Entidad de Red ISIS 2 (NET 2) (Opcional):</label>
                <input type="text" id="NETWORK-ENTITY-2" name="NETWORK-ENTITY-2" pattern="^([0-9A-Fa-f]{2}\.){3}([0-9A-Fa-f]{4}\.){2}[0-9A-Fa-f]{2}$" placeholder="Ej: 49.0002.0000.0001.00 (dejar en blanco si no aplica)">
                <div class="description">La dirección NET para la segunda instancia ISIS.</div>
            </div>

            <h3>Configuración de VLANs e Interfaces de Servicio</h3>
            <div class="form-group">
                <label for="VLAN_SSJ">VLAN para Servicios (SSJ):</label>
                <input type="number" id="VLAN_SSJ" name="VLAN_SSJ" placeholder="Ej: 1000">
                <div class="description">El ID de la VLAN para el segmento de servicios específicos (SSJ).</div>
            </div>

            <div class="form-group">
                <label for="IP_SSJ">Dirección IP para VLAN SSJ:</label>
                <input type="text" id="IP_SSJ" name="IP_SSJ" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}(\/[0-9]{1,2})?$" placeholder="Ej: 172.16.0.1/24">
                <div class="description">La dirección IP asignada a la interfaz VLANif de SSJ.</div>
            </div>

            <div class="form-group">
                <label for="VLAN_AP">VLAN para Puntos de Acceso (AP):</label>
                <input type="number" id="VLAN_AP" name="VLAN_AP" placeholder="Ej: 2000">
                <div class="description">El ID de la VLAN para los puntos de acceso (AP).</div>
            </div>

            <div class="form-group">
                <label for="IP_AP">Dirección IP para VLAN AP:</label>
                <input type="text" id="IP_AP" name="IP_AP" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}(\/[0-9]{1,2})?$" placeholder="Ej: 172.17.0.1/24">
                <div class="description">La dirección IP asignada a la interfaz VLANif de AP.</div>
            </div>

            <div class="form-group">
                <label for="VLAN_GPON">VLAN para GPON:</label>
                <input type="number" id="VLAN_GPON" name="VLAN_GPON" placeholder="Ej: 500 o 501">
                <div class="description">El ID de la VLAN para la red GPON (500 o 501).</div>
            </div>

            <div class="form-group">
                <label for="IP_GPON">Dirección IP para VLAN GPON:</label>
                <input type="text" id="IP_GPON" name="IP_GPON" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}(\/[0-9]{1,2})?$" placeholder="Ej: 172.18.0.1/24">
                <div class="description">La dirección IP asignada a la interfaz VLANif de GPON.</div>
            </div>

            <h3>Configuración de Pools de DHCP</h3>
            <div class="form-group">
                <label for="IP_POOL_GPON">Pool de IP para GPON (Inicio):</label>
                <input type="text" id="IP_POOL_GPON" name="IP_POOL_GPON" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$" placeholder="Ej: 172.18.0.10" required>
                <div class="description">La dirección IP de inicio del rango para el pool DHCP de GPON.</div>
            </div>

            <div class="form-group">
                <label for="MASK_POOL_GPON">Máscara de Subred para Pool GPON:</label>
                <input type="text" id="MASK_POOL_GPON" name="MASK_POOL_GPON" pattern="^((255\.){3}(255|254|252|248|240|224|192|128|0))|((255\.){2}(255|254|252|248|240|224|192|128|0)\.0)|((255\.)(255|254|252|248|240|224|192|128|0)\.0\.0)|((255|254|252|248|240|224|192|128|0)\.0\.0\.0)$" placeholder="Ej: 255.255.255.0" required>
                <div class="description">La máscara de subred para el pool DHCP de GPON (formato decimal punteado).</div>
            </div>

            <div class="form-group">
                <label for="IP_POOL_DHCP">Pool de IP para DHCP General (Inicio):</label>
                <input type="text" id="IP_POOL_DHCP" name="IP_POOL_DHCP" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$" placeholder="Ej: 192.168.10.10" required>
                <div class="description">La dirección IP de inicio del rango para un pool DHCP general.</div>
            </div>

            <div class="form-group">
                <label for="MASK_POOL_DHCP">Máscara de Subred para Pool DHCP General:</label>
                <input type="text" id="MASK_POOL_DHCP" name="MASK_POOL_DHCP" pattern="^((255\.){3}(255|254|252|248|240|224|192|128|0))|((255\.){2}(255|254|252|248|240|224|192|128|0)\.0)|((255\.)(255|254|252|248|240|224|192|128|0)\.0\.0)|((255|254|252|248|240|224|192|128|0)\.0\.0\.0)$" placeholder="Ej: 255.255.255.0" required>
                <div class="description">La máscara de subred para el pool DHCP general (formato decimal punteado).</div>
            </div>

            <div class="form-actions">
                <button type="button" onclick="generarScript()" class="main-button">Generar Script de Configuración</button>
                <button type="button" onclick="descargarScript()" class="download-button">Descargar Script</button>
                <button type="button" onclick="window.location.href = 'index.html'" class="back-button">Volver</button>
            </div>
        </form>

        <h3>Script Generado:</h3>
        <textarea id="scriptGenerado" rows="30" cols="100" readonly></textarea>
    </div>

    <script>
        // Función para generar el script de configuración
        function generarScript() {
            // El template del script de configuración de Huawei para MPLS2
            const baseTemplateScript = `system-view
#
loop-detection enable
#
clock timezone AR minus 03:00:00
#
sysname [NAME]
#
set neid 75d7ea
#
command-privilege level rearrange
#
undo FTP server-source all-interface
undo FTP ipv6 server-source all-interface
#
cpu-defend policy 1
 car dhcp cir 500
 car hwtacacs cir 200
 car icmp cir 100
 car igmp cir 200
 car pim cir 500
 car snmp cir 500
 car vrrp cir 1000
 car arp cir 1000
 car ipv4-ttl-expire cir 100
 car ipv6-ttl-expire cir 100
 car arp-miss cir 500
 alarm drop-rate application-apperceive threshold 100 interval 60
 alarm drop-rate blacklist threshold 100 interval 60
#
undo user-security-policy enable
#
service-template template-default0
#
service-template template-default1
#
service-template template-default2
#
service-template template-default3
#
service-template template-default4
#
							   
ntp-service server source-interface all disable
ntp-service ipv6 server source-interface all disable
#
VLAN_BATCH_PLACEHOLDER
#
undo icmp name timestamp-reply send
#
router id [LOOPBACK0]
#
set flow-stat interval 30
#
set save-configuration interval 1440
#
undo telnet server enable
undo telnet ipv6 server enable
undo telnet server-source all-interface
undo telnet ipv6 server-source all-interface
#
diffserv domain default
#
diffserv domain 5p3d
#
soc
#
ip vpn-instance __LOCAL_OAM_VPN__
 ipv4-family
 ipv6-family
#
ip vpn-instance cc_service
 ipv4-family
  route-distinguisher [LOOPBACK0]:610
  apply-label per-instance
  vpn-target 65500:610 export-extcommunity
  vpn-target 65500:610 import-extcommunity
#
ip vpn-instance entorno
 ipv4-family
  route-distinguisher [LOOPBACK0]:400
  apply-label per-instance
  vpn-target 65500:400 export-extcommunity
  vpn-target 65500:400 import-extcommunity
#
ip vpn-instance gestion_gpon
 ipv4-family
  route-distinguisher [LOOPBACK0]:500
  apply-label per-instance
  vpn-target 65500:500 export-extcommunity
  vpn-target 65500:500 import-extcommunity
#
ip vpn-instance gestion_gpon2
 ipv4-family
  route-distinguisher [LOOPBACK0]:501
  apply-label per-instance
  vpn-target 65500:501 export-extcommunity
  vpn-target 65500:501 import-extcommunity
#
ip vpn-instance gestion_mpls
 ipv4-family
  route-distinguisher [LOOPBACK0]:100
  apply-label per-instance
  vpn-target 65500:100 export-extcommunity
  vpn-target 65500:100 import-extcommunity
#
ip vpn-instance gestion_voip
 ipv4-family
  route-distinguisher [LOOPBACK0]:600
  apply-label per-instance
  vpn-target 65500:600 export-extcommunity
  vpn-target 65500:600 import-extcommunity
#
ip vpn-instance internet
 ipv4-family
  route-distinguisher [LOOPBACK0]:1
  apply-label per-instance
  vpn-target 65500:1 export-extcommunity
  vpn-target 65500:1 import-extcommunity
#
ip vpn-instance internet_dhcp
 ipv4-family
  route-distinguisher [LOOPBACK0]:20
  apply-label per-instance
  vpn-target 65500:20 export-extcommunity
  vpn-target 65500:20 import-extcommunity
#
ip vpn-instance internet_gpon
 ipv4-family
  route-distinguisher [LOOPBACK0]:30
  apply-label per-instance
  vpn-target 65500:30 export-extcommunity
  vpn-target 65500:30 import-extcommunity
# 
ip vpn-instance internet_ipv6
 ipv4-family
  route-distinguisher [LOOPBACK0]:10
  apply-label per-instance
  vpn-target 65500:10 export-extcommunity
  vpn-target 65500:10 import-extcommunity
 ipv6-family
#
undo radius local-ip all
#
bfd
#
vlan 20
 description Gpon-Internet
#
VLAN_SSJ_DESCRIPTION_PLACEHOLDER
VLAN_AP_DESCRIPTION_PLACEHOLDER
#
vlan 450
 description Entorno
#
mpls lsr-id [LOOPBACK0]
#
mpls
 label advertise non-null
#
mpls l2vpn
#
mpls ldp
 #
 ipv4-family
#
dhcp server request-packet all-interface disable
#
dot1x-template 1
#
acl number 2000
 rule 15 permit vpn-instance gestion_mpls source 10.10.0.1 0
 rule 20 permit vpn-instance gestion_mpls source 10.10.1.1 0
#
security password
 #
 rule admin
  forbidden word changeme_123
#
aaa
 user-password password-force-change disable
 local-user huawei password irreversible-cipher Jujuy_12#$
 local-user huawei service-type ssh
 local-user huawei password-force-change disable
 local-user huawei level 15
 local-user huawei state active
 #
 authentication-scheme default0
 #
 authentication-scheme default1
 #
 authentication-scheme default
  authentication-mode local radius
 #
 authorization-scheme default
 #
 accounting-scheme default0
 #
 accounting-scheme default1
 #
 domain default0
 #
 domain default1
 #
 domain default_admin
#
license
#
warranty
#
isis [ISIS_PROCESS_1]
 is-level level-2
 cost-style wide
 bfd all-interfaces enable
 bfd all-interfaces min-tx-interval 100 min-rx-interval 100
 bandwidth-reference 1000000
 ldp-sync enable
 network-entity [NETWORK-ENTITY-1]
 y
 is-name [IS-NAME]
 import-route direct route-policy loopback0
 timer spf 1 50 50
 timer lsp-refresh 600
 set-overload on-startup 300
 frr
  loop-free-alternate level-2
#
ISIS_PROCESS_2_BLOCK_PLACEHOLDER
#
interface Vlanif450
 description Entorno
 ip binding vpn-instance entorno
  
#
interface Ethernet0/0/0
 speed auto
 duplex auto
 undo shutdown
 ip binding vpn-instance __LOCAL_OAM_VPN__
#
interface Virtual-Template0
 ppp authentication-mode auto
#
interface GigabitEthernet0/1/0
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/1/1
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/1/2
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/1/3
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/1/4
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/1/5
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/1/6
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/1/7
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/1/8
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/1/9
 description To_GPON1
 undo shutdown
 undo dcn
#
GPON_INTERFACE_BLOCK_PLACEHOLDER
#
interface GigabitEthernet0/2/0
 description To_SSJ and To_AP
 undo shutdown
 undo dcn
#
SSJ_INTERFACE_BLOCK_PLACEHOLDER
#
AP_INTERFACE_BLOCK_PLACEHOLDER
#
interface GigabitEthernet0/2/1
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/2/2
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/2/3
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/2/4
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/2/5
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/2/6
 portswitch
 description To_Gabinete
 undo shutdown
 port link-type access
 port default vlan 450
 undo dcn
#
interface GigabitEthernet0/2/7
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/2/8
 undo shutdown
 undo dcn
#
#
interface GigabitEthernet0/2/9
undo shutdown
undo dcn
#
DHCP_INTERFACE_BLOCK_PLACEHOLDER
#
interface GigabitEthernet0/7/0
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/7/1
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/7/2
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/7/3
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/7/4
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/7/5
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/7/6
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/7/7
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/7/8
 undo shutdown
 undo dcn
#
interface GigabitEthernet0/7/9
 undo shutdown
 undo dcn
#
interface 100GE0/3/0
 undo shutdown
 undo dcn
#
interface 100GE0/3/1
 undo shutdown
 undo dcn
#
interface 100GE0/5/0
 undo shutdown
 undo dcn
#
interface 100GE0/5/1
 undo shutdown
 undo dcn
#
interface LoopBack0
 ip address [LOOPBACK0] 255.255.255.255
#
interface LoopBack10
 description VPN Gestion
 ip binding vpn-instance gestion_mpls
 ip address [LOOPBACK0] 255.255.255.255
#
mpls-in-udp
#
interface NULL0
#
bgp 272052
 undo default ipv4-unicast
 timer keepalive 5 hold 15
 private-4-byte-as enable
 group IND_CORE-IP internal
 peer IND_CORE-IP connect-interface LoopBack0
 peer IND_CORE-IP bfd min-tx-interval 150 min-rx-interval 150
 peer IND_CORE-IP bfd enable
 peer 172.16.0.1 as-number 272052
 peer 172.16.0.1 group IND_CORE-IP
 peer 172.16.0.1 description COAP1-380036000-MPLS1
 peer 172.16.0.2 as-number 272052
 peer 172.16.0.2 group IND_CORE-IP
 peer 172.16.0.2 description DMBSSJ1-388888888-MPLS1
 #
 ipv4-family unicast
  undo synchronization
  reflector cluster-id [LOOPBACK0]
  network [LOOPBACK0] 255.255.255.255
  auto-frr
  bestroute nexthop-resolved tunnel
  peer IND_CORE-IP enable
  peer IND_CORE-IP route-policy bgp-label export
  peer IND_CORE-IP next-hop-local
  peer IND_CORE-IP label-route-capability check-tunnel-reachable
  peer IND_CORE-IP advertise-community
  peer IND_CORE-IP advertise-ext-community
  peer IND_CORE-IP route-update-interval 5
  peer 172.16.0.1 enable
  peer 172.16.0.1 group IND_CORE-IP
  peer 172.16.0.2 enable
  peer 172.16.0.2 group IND_CORE-IP
 #
 ipv4-family vpnv4
  reflector cluster-id [LOOPBACK0]
  policy vpn-target
  auto-frr
  bestroute nexthop-resolved tunnel
  peer IND_CORE-IP enable
  peer IND_CORE-IP advertise-community
  peer 172.16.0.1 enable
  peer 172.16.0.1 group IND_CORE-IP
  peer 172.16.0.2 enable
  peer 172.16.0.2 group IND_CORE-IP
 #
 ipv4-family vpn-instance cc_service
  import-route direct
  import-route static
 #
 ipv4-family vpn-instance entorno
  import-route direct
  import-route static
 #
 ipv4-family vpn-instance gestion_gpon
  import-route direct
  import-route static
 #
 ipv4-family vpn-instance gestion_gpon2
  import-route direct
  import-route static
 #
 ipv4-family vpn-instance gestion_mpls
  import-route direct
  import-route static
 #
 ipv4-family vpn-instance gestion_voip
  import-route direct
  import-route static
 #
 ipv4-family vpn-instance internet
  import-route direct
  import-route static
#
undo dcn
#
ip ip-prefix loopback0 index 10 permit [LOOPBACK0] 32 greater-equal 32 less-equal 32
#
route-policy bgp-label permit node 10
 apply mpls-label
#
route-policy loopback0 permit node 10
 if-match ip-prefix loopback0
#
ip route-static vpn-instance internet 10.10.0.32 255.255.255.248 10.10.0.33 description To_DHCP_Server
#
snmp-agent
snmp-agent acl 2000
snmp-agent local-engineid 800007DB0364C3946E8385
#
snmp-agent sys-info version all
snmp-agent group v3 nce-group privacy read-view nce-view write-view nce-view notify-view nce-view acl 2000
snmp-agent target-host host-name NMS-Server.Master trap address udp-domain 10.10.0.1 vpn-instance gestion_mpls params securityname nce-user v3 privacy
snmp-agent target-host host-name NMS-Server.Slave trap address udp-domain 10.10.0.9 vpn-instance entorno params securityname nce-user v3 privacy
#
snmp-agent mib-view included nce-view iso
snmp-agent usm-user v3 nce-user
snmp-agent usm-user v3 nce-user group nce-group
snmp-agent usm-user v3 nce-user authentication-mode sha2-512 cipher %^%#(9DUQC^~@U7rX='BLdD-'4yM>{Q2V/Mj:ZJt["r=%^%#
snmp-agent usm-user v3 nce-user privacy-mode aes256 cipher %^%#[T)w*c!1;$C8^,@ie5#.PQ{8IO}EV/(AIT-xH"m~%^%#
#
snmp-agent extend error-code enable
#
snmp-agent protocol source-status all-interface
undo snmp-agent protocol source-status ipv6 all-interface
#
undo snmp-agent proxy protocol source-status all-interface
undo snmp-agent proxy protocol source-status ipv6 all-interface
#
lldp enable
#
undo web-auth-server source-ip all
#
undo web-auth-server source-ipv6 all
#
stelnet server enable
sftp server enable
snetconf server enable
ssh server rsa-key min-length 3072
sftp server default-directory cfcard:
ssh user Huawei
ssh user Huawei authentication-type password
ssh user Huawei service-type all
ssh user Huawei sftp-directory cfcard:/
ssh user root
ssh user root authentication-type password
ssh user root service-type snetconf stelnet
								  
ssh server-source all-interface
ssh ipv6 server-source all-interface
ssh server ip-block disable
ssh authorization-type default aaa
#
ssh server cipher aes256_ctr aes128_ctr
ssh server hmac sha2_256
ssh server key-exchange dh_group_exchange_sha256
#
ssh server publickey rsa_sha2_256 rsa_sha2_512
#
ssh server dh-exchange min-len 2048
#
ssh client first-time enable
#
sftp client-source -i LoopBack10
#
ssh client publickey ecc rsa rsa_sha2_256 rsa_sha2_512
#
ssh client cipher aes256_ctr aes128_ctr
ssh client hmac sha2_256
#
ssh client key-exchange dh_group_exchange_sha256 dh_group16_sha512
#
user-interface maximum-vty 21
#
user-interface con 0
 authentication-mode password
 set authentication password cipher $1c$|yxf)$Sx[C$M#7}/cK6_R%kDOC7})WP=<u@/m""aWm{u+7$:iD>$
#
user-interface vty 0 10
 authentication-mode aaa
 user privilege level 15
 history-command max-size 256
 idle-timeout 30 0
 protocol inbound ssh
#
netconf
 activate module huawei-ip
#
local-aaa-server
#
pki domain default
#
l2tp-group default-lac
 tunnel name HUAWEI
#
l2tp-group default-lns
 tunnel name HUAWEI
#
return`;

            // Obtener los valores de los campos del formulario
            const name = document.getElementById('IS-NAME').value;
            const loopback0 = document.getElementById('LOOPBACK0').value;
            const isisProcess1 = document.getElementById('ISIS_PROCESS_1').value;
            const isisProcess2 = document.getElementById('ISIS_PROCESS_2').value;
            const networkEntity1 = document.getElementById('NETWORK-ENTITY-1').value;
            const networkEntity2 = document.getElementById('NETWORK-ENTITY-2').value;

            // VLAN and IP values for conditional interfaces
            const vlanSsj = document.getElementById('VLAN_SSJ').value.trim();
            const ipSsj = document.getElementById('IP_SSJ').value.trim();
            const vlanAp = document.getElementById('VLAN_AP').value.trim();
            const ipAp = document.getElementById('IP_AP').value.trim();
            const vlanGpon = document.getElementById('VLAN_GPON').value.trim();
            const ipGpon = document.getElementById('IP_GPON').value.trim();

            const ipPoolGpon = document.getElementById('IP_POOL_GPON').value;
            const maskPoolGpon = document.getElementById('MASK_POOL_GPON').value;
            const ipPoolDhcp = document.getElementById('IP_POOL_DHCP').value;
            const maskPoolDhcp = document.getElementById('MASK_POOL_DHCP').value;

            // Start building the script
            let generatedScript = baseTemplateScript;

            // Replace common placeholders
            generatedScript = generatedScript.replace(/\[LOOPBACK0\]/g, loopback0);
            generatedScript = generatedScript.replace(/\[NAME\]/g, name);
            generatedScript = generatedScript.replace(/\[IS-NAME\]/g, name);
            generatedScript = generatedScript.replace(/\[ISIS_PROCESS_1\]/g, isisProcess1);
            generatedScript = generatedScript.replace(/\[NETWORK-ENTITY-1\]/g, networkEntity1);
            generatedScript = generatedScript.replace(/\[VLAN_SSJ\]/g, vlanSsj);
            generatedScript = generatedScript.replace(/\[VLAN_AP\]/g, vlanAp);
            generatedScript = generatedScript.replace(/\[VLAN_GPON\]/g, vlanGpon);
            generatedScript = generatedScript.replace(/\[IP_SSJ\]/g, ipSsj);
            generatedScript = generatedScript.replace(/\[IP_AP\]/g, ipAp);
            generatedScript = generatedScript.replace(/\[IP_GPON\]/g, ipGpon);
            generatedScript = generatedScript.replace(/\[IP_POOL_GPON\]/g, ipPoolGpon);
            generatedScript = generatedScript.replace(/\[MASK_POOL_GPON\]/g, maskPoolGpon);
            generatedScript = generatedScript.replace(/\[IP_POOL_DHCP\]/g, ipPoolDhcp);
            generatedScript = generatedScript.replace(/\[MASK_POOL_DHCP\]/g, maskPoolDhcp);

            // Handle optional ISIS_PROCESS_2 and NETWORK-ENTITY-2
            let isisProcess2Block = '';
            if (isisProcess2.trim() && networkEntity2.trim()) {
                isisProcess2Block = `isis ${isisProcess2}
 is-level level-2
 cost-style wide
 bfd all-interfaces enable
 bfd all-interfaces min-tx-interval 100 min-rx-interval 100
 bandwidth-reference 1000000
 ldp-sync enable
 network-entity ${networkEntity2}
 y
 is-name ${name}
 import-route direct route-policy loopback0
 timer spf 1 50 50
 timer lsp-refresh 600
 set-overload on-startup 300
 frr
  loop-free-alternate level-2
#`;
            } else {
                // If ISIS_PROCESS_2 or NETWORK-ENTITY-2 are not provided, remove the entire block
                generatedScript = generatedScript.replace(/isis \[ISIS_PROCESS_2\][\s\S]*?loop-free-alternate level-2\n#/g, '');
            }
            generatedScript = generatedScript.replace(/ISIS_PROCESS_2_BLOCK_PLACEHOLDER/, isisProcess2Block);


            // Dynamically build vlan batch line
            let vlanBatchList = "10 20 30 100 400 450 460 500 501 600 610";
            if (vlanSsj) {
                vlanBatchList += ` ${vlanSsj}`;
            }
            if (vlanAp) {
                vlanBatchList += ` ${vlanAp}`;
            }
            // VLAN_GPON (500 or 501) is already in the fixed list, no need to add dynamically
            generatedScript = generatedScript.replace(/VLAN_BATCH_PLACEHOLDER/, `vlan batch ${vlanBatchList}`);
            
            // VLAN Descriptions (these are fixed in the template, but we can make them conditional if needed)
            let vlanSsjDescription = '';
            if (vlanSsj) {
                vlanSsjDescription = `vlan ${vlanSsj}\n description To_SSJ\n#\n`;
            } else {
                generatedScript = generatedScript.replace(/vlan \[VLAN_SSJ\]\n description To_SSJ\n#/g, '');
            }

            let vlanApDescription = '';
            if (vlanAp) {
                vlanApDescription = `vlan ${vlanAp}\n description To_Abra_Pampa\n#\n`;
            } else {
                generatedScript = generatedScript.replace(/vlan \[VLAN_AP\]\n description To_Abra_Pampa\n#/g, '');
            }

            // Replace placeholders for VLAN descriptions
            generatedScript = generatedScript.replace(/VLAN_SSJ_DESCRIPTION_PLACEHOLDER/, vlanSsjDescription);
            generatedScript = generatedScript.replace(/VLAN_AP_DESCRIPTION_PLACEHOLDER/, vlanApDescription);


            // Conditional Interface blocks
            let gponInterfaceBlock = '';
            // If both VLAN_GPON and IP_GPON are provided, create both subinterfaces
            if (vlanGpon && ipGpon) {
                gponInterfaceBlock = `interface GigabitEthernet0/1/9.20
 vlan-type dot1q 20
 description gestion_internet
 ip binding vpn-instance internet
 ipv6 enable
 ip address ${ipPoolGpon} ${maskPoolGpon}
 trust upstream default
#
interface GigabitEthernet0/1/9.${vlanGpon}
 vlan-type dot1q ${vlanGpon}
 description gestion_gpon
 ip binding vpn-instance gestion_gpon
 ipv6 enable
 ip address ${ipGpon} 255.255.248.0
 trust upstream default
#`;
            } else {
                // If neither VLAN_GPON nor IP_GPON is provided, remove these specific subinterface blocks
                generatedScript = generatedScript.replace(/interface GigabitEthernet0\/1\/9\.20[\s\S]*?trust upstream default\n#/g, '');
                generatedScript = generatedScript.replace(/interface GigabitEthernet0\/1\/9\.\[VLAN_GPON\][\s\S]*?trust upstream default\n#/g, '');
            }
            generatedScript = generatedScript.replace(/GPON_INTERFACE_BLOCK_PLACEHOLDER/, gponInterfaceBlock);

            let ssjInterfaceBlock = '';
            if (vlanSsj && ipSsj) { // Both VLAN and IP must be present
                ssjInterfaceBlock = `interface GigabitEthernet0/2/0.${vlanSsj}
 vlan-type dot1q ${vlanSsj}
 mtu 9000
 description To_SSJ
 ipv6 enable
 ip address ${ipSsj} 255.255.255.252
 trust upstream default
 isis enable ${isisProcess1}
 isis circuit-type p2p
 isis circuit-level level-2
 ip netstream inbound
 mpls
 mpls ldp
#`;
            } else {
                generatedScript = generatedScript.replace(/interface GigabitEthernet0\/2\/0\.\[VLAN_SSJ\][\s\S]*?mpls ldp\n#/g, '');
            }
            generatedScript = generatedScript.replace(/SSJ_INTERFACE_BLOCK_PLACEHOLDER/, ssjInterfaceBlock);

            let apInterfaceBlock = '';
            if (vlanAp && ipAp) { // Both VLAN and IP must be present
                apInterfaceBlock = `interface GigabitEthernet0/2/0.${vlanAp}
 vlan-type dot1q ${vlanAp}
 mtu 9000
 description To_AP
 ipv6 enable
 ip address ${ipAp} 255.255.255.252
 trust upstream default
 isis enable ${isisProcess1}
 isis circuit-type p2p
 isis circuit-level level-2
 ip netstream inbound
 mpls
 mpls ldp
#`;
            } else {
                generatedScript = generatedScript.replace(/interface GigabitEthernet0\/2\/0\.\[VLAN_AP\][\s\S]*?mpls ldp\n#/g, '');
            }
            generatedScript = generatedScript.replace(/AP_INTERFACE_BLOCK_PLACEHOLDER/, apInterfaceBlock);

            let dhcpInterfaceBlock = '';
            if (ipPoolDhcp && maskPoolDhcp) {
                dhcpInterfaceBlock = `interface GigabitEthernet0/2/9.30
vlan-type dot1q 30
description DHCP_Esc_****
ip binding vpn-instance internet
ip address ${ipPoolDhcp} ${maskPoolDhcp}
dhcp select relay
ip relay address 10.10.0.34
ip relay address 10.10.0.35
ip relay giaddr ${ipPoolDhcp}
#`;
            } else {
                generatedScript = generatedScript.replace(/interface GigabitEthernet0\/2\/9\.30[\s\S]*?ip relay giaddr \[IP_POOL_DHCP\]\n#/g, '');
            }
            generatedScript = generatedScript.replace(/DHCP_INTERFACE_BLOCK_PLACEHOLDER/, dhcpInterfaceBlock);


            // Actualizar la configuración AAA (this block remains constant)
            const newAaaConfig = `aaa
 user-password password-force-change disable
 local-user huawei password irreversible-cipher Jujuy_12#$
 local-user huawei service-type ssh
 local-user huawei password-force-change disable
 local-user huawei level 15
 local-user huawei state active
 #
 authentication-scheme default0
 #
 authentication-scheme default1
 #
 authentication-scheme default
  authentication-mode local radius
 #
 authorization-scheme default
 #
 accounting-scheme default0
 #
 accounting-scheme default1
 #
 domain default0
 #
 domain default1
 #
 domain default_admin
#`;
            generatedScript = generatedScript.replace(/aaa\s+user-password password-force-change disable[\s\S]*?domain default_admin\n#/g, newAaaConfig);


            // Mostrar el script generado en el textarea
            document.getElementById('scriptGenerado').value = generatedScript;
        }

        // Función para descargar el script generado como un archivo .cfg
        function descargarScript() {
            const scriptContent = document.getElementById('scriptGenerado').value;
            // Obtener el valor del campo 'IS-NAME' para usarlo como nombre de archivo
            let hostname = document.getElementById('IS-NAME').value.trim(); 
            // Si el hostname está vacío, usar un valor predeterminado
            if (hostname === '') {
                hostname = 'unnamed_router';
            }
            // Construir el nombre del archivo con el hostname y la extensión .cfg
            const filename = `${hostname}.cfg`; 
            
            const blob = new Blob([scriptContent], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(a.href);
        }
    </script>
</body>
</html>
